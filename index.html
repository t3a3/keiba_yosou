<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/main.css">
</head>

<body>
    <!------------ヘッダー------------>
    <header>
        <h1>競馬予想</h1>
    </header>
    <main>
        <!------------競馬表------------->
        <table>
            <tr>
                <th>枠番</th>
                <th>馬番</th>
                <th>出走馬</th>
                <th>Aさん</th>
                <th>Bさん</th>
                <th>Cさん</th>
            </tr>
            <!-------1番------->
            <tr>
                <!--枠番-->
                <td>1</td>
                <!--馬番-->
                <td>1</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------2番------->
            <tr>
                <!--枠番-->
                <td>1</td>
                <!--馬番-->
                <td>2</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!--------3番------->
            <tr>
                <!--枠番-->
                <td class="waku_two">2</td>
                <!--馬番-->
                <td>3</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------4番------->
            <tr>
                <!--枠番-->
                <td class="waku_two">2</td>
                <!--馬番-->
                <td>4</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------5番------->
            <tr>
                <!--枠番-->
                <td class="waku_three">3</td>
                <!--馬番-->
                <td>5</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!--------6番------->
            <tr>
                <!--枠番-->
                <td class="waku_three">3</td>
                <!--馬番-->
                <td>6</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------7番------->
            <tr>
                <!--枠番-->
                <td class="waku_four">4</td>
                <!--馬番-->
                <td>7</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------8番------->
            <tr>
                <!--枠番-->
                <td class="waku_four">4</td>
                <!--馬番-->
                <td>8</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------9番------->
            <tr>
                <td class="waku_five">5</td>
                <!--馬番-->
                <td>9</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------10番------->
            <tr>
                <td class="waku_five">5</td>
                <!--馬番-->
                <td>10</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!--------11番------->
            <tr>
                <!--枠番-->
                <td class="waku_six">6</td>
                <!--馬番-->
                <td>11</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------12番------->
            <tr>
                <!--枠番-->
                <td class="waku_six">6</td>
                <!--馬番-->
                <td>12</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------13番------->
            <tr>
                <!--枠番-->
                <td class="waku_seven">7</td>
                <!--馬番-->
                <td>13</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------14番------->
            <tr>
                <!--枠番-->
                <td class="waku_seven">7</td>
                <!--馬番-->
                <td>14</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------15番------->
            <tr>
                <!--枠番-->
                <td class="waku_seven">7</td>
                <!--馬番-->
                <td>15</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------16番------->
            <tr>
                <!--枠番-->
                <td class="waku_eight">8</td>
                <!--馬番-->
                <td>16</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------17番------->
            <tr>
                <!--枠番-->
                <td class="waku_eight">8</td>
                <!--馬番-->
                <td>17</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
            <!-------18番------->
            <tr>
                <!--枠番-->
                <td class="waku_eight">8</td>
                <!--馬番-->
                <td>18</td>
                <!--馬名-->
                <td class="horse_name"><input type="text" style="border:none" class="horse_name_text"></td>
                <!--人名-->
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
                <td><select name="" class="horse_performance"></select></td>
            </tr>
        </table>
        <button id="send">SAVE</button>
        <button id="send2">SAVE2</button>
        <button id="send3">SAVE3</button>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script type="module">
        //Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            doc,
            setDoc,
            serverTimestamp,
            onSnapshot,
            updateDoc
        } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-firestore.js";
        const firebaseConfig = {
            apiKey: "AIzaSyAdV_9QmkVXhkA1jMQy1gB7fPVje5nb7eE",
            authDomain: "keibayosou-5a4f9.firebaseapp.com",
            projectId: "keibayosou-5a4f9",
            storageBucket: "keibayosou-5a4f9.appspot.com",
            messagingSenderId: "169743914564",
            appId: "1:169743914564:web:43ee0024827d86a8cb8e11"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        //firestoreの配列を取得して反映
        onSnapshot(collection(db, "hyouka"), (querySnapshot) => {
            console.log(querySnapshot.docs);
            const dataArray = [];
            querySnapshot.docs.forEach(function (doc) {
                const data = {
                    id: doc.id,
                    data: doc.data(),
                };
                dataArray.push(data);
            });
            console.log(dataArray);
            const tagArray = [];
            dataArray[0].data.mark.forEach(function (data) {
                tagArray.push(data);
            });
            const nameArray = [];
            dataArray[0].data.name.forEach(function (data) {
                nameArray.push(data);
            });
            console.log(tagArray);
            console.log(nameArray);
            for (i = 0; i < 54; i++) {
                $("#mark_box" + (i + 1)).val(tagArray[i]);
            };
            for (i = 0; i < 18; i++) {
                $("#name" + (i + 1)).val(nameArray[i]);
            };
        });
        //SAVEボタンを押してFirebaseに送る
        let hyouka_array = [];
        let name_array = [];
        $("#send").on("click", function () {
            hyouka_array = [];
            for (i = 0; i < 54; i++) {
                hyouka_array.push($("#mark_box" + (i + 1)).val());
            };
            console.log(hyouka_array);
            const washingtonRef = doc(db, "hyouka", "iH9yRx5xzGFRcbImn9OP");
            updateDoc(washingtonRef, {
                mark: hyouka_array
            });
            name_array = [];
            for (i = 0; i < 18; i++) {
                name_array.push($("#name" + (i + 1)).val());
            };
            console.log(name_array);
            updateDoc(washingtonRef, {
                name: name_array
            });
        });



    </script>
    <script>
        //class="horse_performance"があるタグにidを生成
        $("select.horse_performance").each(function (i) {
            $(this).attr("id", "mark_box" + (i + 1));
        });
        //class="horse_performance"があるタグにidを生成
        $("input.horse_name_text").each(function (i) {
            $(this).attr("id", "name" + (i + 1));
        });
        //評価記号の配列["",◎,〇,▲,△,☆]
        const list01 = ["", "&#9678;", "&#9711;", "&#9650;", "&#9651;", "&#10025;"];
        let array = [];
        for (let i = 0; i < list01.length; i++) {
            array.push("<option>" + list01[i] + "</option>");
            console.log(array);
        };
        //id="mark_box[i]"に評価記号の配列を適応させる
        for (i = 0; i < 54; i++) {
            $("#mark_box" + (i + 1)).html(array);
        };
        //let hyouka_array = [];
        //$("#send2").on("click", function () {
        //    hyouka_array = [];
        //    for (i = 0; i < 54; i++) {
        //        hyouka_array.push($("#mark_box" + (i + 1)).val());
        //    };
        //    console.log(hyouka_array);
        //});
    </script>
</body>

</html>